<!DOCTYPE html>
<html lang="ja">

<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="HIW 2019で発表された、GHC 8.8で導入された機能">
    
      <meta name="author" content="Yuji Yamamoto">
    
    <link rel="alternate" type="application/atom+xml" title="Haskell-jp Blog" href="https://haskell.jp/blog/feed.xml" />
    <link rel="icon" href="https://haskell.jp/img/favicon.png" />

    <!-- OGP Settings -->
    <meta property="og:title" content="HIW 2019で発表された、GHC 8.8で導入された機能 - Haskell-jp" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="/posts/2019/hiw-ghc8.8.html" />
    <meta property="og:image" content="https://haskell.jp/blog/img/logo-square.png" />
    <meta property="og:site_name" content="Haskell-jp Blog" />
    <meta property="og:description" content="---こんにちは。  今回からいくつか、「[Haskell Implementors' Workshop 2019](https://icfp19.sigplan.org/home/hiw-2019#About)」に私が先月参加した際のレポートとして、印象深い発表をテーマごとに分けた短い記事を執筆します。  最近公開された[GHC 8.8](https://www.haskell.org/" />

    <!-- Twitter Card Settings -->
    <meta name="twitter:card" content="summary" />

    

    <title>HIW 2019で発表された、GHC 8.8で導入された機能 - Haskell-jp</title>

    <!-- Bootstrap Core CSS -->
    <link href="../../css/bootstrap.css" rel="stylesheet">
    <!-- <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet"> -->

    <!-- Pandoc syntax highlighting CSS -->
    <link href="../../css/syntax.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../../css/clean-blog.css" rel="stylesheet">

    <!-- Our original CSS -->
    <link href="../../css/style.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://haskell.jp"><img src="../../img/logo.svg"></a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="../../posts/about_us.html">About</a>
                    </li>
                    <li>
                        <a href="../../">Blog</a>
                    </li>
                    <li>
                        <a href="https://haskell.jp/signin-slack.html">Slack Team</a>
                    </li>
                    <li>
                        <a href="https://www.reddit.com/r/haskell_jp/">Reddit</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>
    
    <!-- Page Header -->
    <header class="intro-header" style="background-image: url('../../img/background.png'); background-color: #F3DFBC;">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    
                    <div lang="ja" class="post-heading">
                    
                        <div class="jumbotron page-header-jumbotron">
                            <h1>HIW 2019で発表された、GHC 8.8で導入された機能</h1>
                            <h2 class="subheading">～HIW 2019参加レポート その1～</h2><span class="meta">Posted by <a href="http://the.igreque.info/">Yuji Yamamoto(@igrep)</a> on September 11, 2019</span><span class="meta">Tags: GHC, Haskell Implementors' Workshop</span>
                            <div class="text-right" style="margin-top: 2em;">
                                <a class="btn btn-primary" href="https://github.com/haskell-jp/blog#%E8%A8%98%E4%BA%8B%E3%82%92%E6%8A%95%E7%A8%BF%E3%81%97%E3%81%9F%E3%81%84%E5%A0%B4%E5%90%88" role="button">
                                    投稿したい方はこちら
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    
<article lang="ja">

    <div class="container">
        <div class="row">
            <div class="col-lg-offset-2 col-lg-8 col-md-offset-1 col-md-10">
                <ul class="social-buttons">
                    <li><div>
                        <a href="https://twitter.com/share" class="twitter-share-button">Tweet</a>
                        <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                    </div></li>
                    <li><div>
                        <script type="text/javascript">
                            reddit_target = "haskell_jp";
                            reddit_title  = document.title;
                        </script>
                        <script type="text/javascript" src="//www.redditstatic.com/button/button1.js"></script>
                    </div></li>
                    <li><div>
                        <a data-pocket-label="pocket" data-pocket-count="horizontal" class="pocket-btn" data-lang="en"></a>
                        <script type="text/javascript">!function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");</script>
                    </div></li>
                </ul>
            </div>
        </div>
        <div class="row">
            <div id="md-post-content" class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
              <hr />
<p>こんにちは。<br />
今回からいくつか、「<a href="https://icfp19.sigplan.org/home/hiw-2019#About"><span class="ascii">Haskell Implementors</span>’ <span class="ascii">Workshop 2019</span></a>」に私が先月参加した際のレポートとして、印象深い発表をテーマごとに分けた短い記事を執筆します。<br />
最近公開された<a href="https://www.haskell.org/ghc/download_ghc_8_8_1.html"><span class="ascii">GHC 8.8</span></a>の話はもちろん、未来の<span class="ascii">GHC</span>やその他の<span class="ascii">Haskell</span>の処理系を知るのによいイベントでしたので、その一部だけでも伝われば幸いです。</p>
<div id="table-of-contents-outer">
<div id="table-of-contents">
<div class="table-of-contents-title">
Contents
</div>
<ul>
<li><a href="#そもそもhaskell-implementors-workshop-hiwとは" title="そもそもhaskell-implementors-workshop-hiwとは">そもそも<span class="ascii">Haskell Implementors</span>’ <span class="ascii">Workshop (HIW)</span>とは？</a></li>
<li><a href="#hie-files-in-ghc-8.8" title="hie-files-in-ghc-8.8"><span class="ascii">HIE files in GHC 8.8</span></a></li>
<li><a href="#ghc-status-report" title="ghc-status-report"><span class="ascii">GHC status report</span></a></li>
<li><a href="#とりあえず今回はここまで" title="とりあえず今回はここまで">とりあえず今回はここまで</a></li>
</ul>
</div>
</div>
<h1 id="そもそもhaskell-implementors-workshop-hiwとは"><span class="link-to-here-outer"><a href="#そもそもhaskell-implementors-workshop-hiwとは" title="そもそもhaskell-implementors-workshop-hiwとは"><span class="link-to-here">Link to<br />
here</span></a></span>そもそも<span class="ascii">Haskell Implementors</span>’ <span class="ascii">Workshop (HIW)</span>とは？</h1>
<p>シリーズ（？）第<span class="ascii">1</span>回目なので、簡単に<span class="ascii">HIW</span>そのものについて紹介しておきましょう。<br />
<span class="ascii">HIW</span>は、<a href="https://icfp19.sigplan.org/home"><span class="ascii">ICFP (International Conference on Functional Programming)</span></a>という関数型プログラミングについての国際会議に併設された、<span class="ascii">Haskell</span>の実装者のためのワークショップです。<br />
名前の通り、<span class="ascii">GHC</span>をはじめとする<span class="ascii">Haskell</span>の処理系<small>（あるいは、<span class="ascii">Haskell</span>で実装された言語処理系）</small>の実装に関する発表だけでなく、かなり緩いテーマの<span class="ascii">Lightning Talk</span>の時間があったり、<span class="ascii">GHC</span>の将来の方向性について自由に議論する時間もあったりしました。</p>
<p>今回はそのうち、掲題のとおり「<span class="ascii">HIW 2019</span>で発表された、<span class="ascii">GHC 8.8</span>で導入された機能」を紹介します。まずは「<span class="ascii">HIE files in GHC 8.8</span>」から。</p>
<h1 id="hie-files-in-ghc-8.8"><span class="link-to-here-outer"><a href="#hie-files-in-ghc-8.8" title="hie-files-in-ghc-8.8"><span class="link-to-here">Link to<br />
here</span></a></span><span class="ascii">HIE files in GHC 8.8</span></h1>
<p>発表者<span class="ascii">: Zubin Duggal, Matthew Pickering</span> <em><span class="ascii">University of Bristol</span></em></p>
<p><span class="ascii">GHC 8.8</span>で新たに追加された、<span class="ascii">HIE</span><small>（「<span class="ascii">Haskell Interface Extended</span>」の略と思われます）</small>ファイルについての発表です。<br />
コンパイル時に<span class="ascii">GHC</span>が得たモジュールの情報を、<a href="https://github.com/haskell/haskell-ide-engine"><span class="ascii">Haskell IDE Engine</span></a>などの<span class="ascii">IDE</span>のバックエンドが再利用しやすい形で出力する機能です。<br />
従来<span class="ascii">Haskell IDE Engine</span><small>（その裏で使われている<span class="ascii">ghc-mod</span>）</small>や<a href="https://github.com/ndmitchell/ghcid"><span class="ascii">ghcid</span></a>、<a href="https://github.com/chrisdone/intero"><span class="ascii">intero</span></a>などの、「<span class="ascii">IDE</span>バックエンド」<small>（エディターが入力の補完や入力したソースコードにおけるエラーを表示する際に通信するソフトウェア）</small>は、自前で<span class="ascii">GHC API</span>や<span class="ascii">GHCi</span>を呼ぶことで、型チェックしたり定義ジャンプに必要な位置情報を収集したりしていたのですが、そうした情報の収集をすべて<span class="ascii">GHC</span>自身が<span class="ascii">HIE</span>ファイルを出力することで賄えるようになる、ということです。</p>
<p>私は従来開発中、<code>stack test --pedantic --file-watch</code>などと<span class="ascii">Neovim</span>のターミナル機能で実行して実行ファイルをビルドしつつ、<span class="ascii">HIE</span>にエラーの表示や入力の補完をさせていたのですが、その際も二重にソースコードが解析されていたんですね！<br />
私がそのようにわざわざ<code>stack test</code>と<span class="ascii">HIE</span>を並行して実行させているのは、<span class="ascii">HIE</span>がしばしばフリーズしてしまったり<small>（<span class="ascii">Neovim</span>ごと再起動すれば直ることも多いんですが…😰）</small>、<span class="ascii">HIE</span>だけでは実行ファイルの作成やテストの実行ができない、という理由があるためです。<br />
<code>stack test</code>だけで<span class="ascii">HIE</span>ファイルが生成されるようになれば、エラーに関する情報やソースコードの解析結果といった情報が一元化されるので、より安定的に、より少ないリソースで<span class="ascii">HIE</span>が使えるようになるでしょう。本家<span class="ascii">Haskell IDE Engine</span>がサポートする日が楽しみです。</p>
<p>この、<span class="ascii">HIE</span>ファイルを利用するアプリケーションの例も紹介されました。<br />
<a href="https://github.com/wz1000/hie-lsp"><span class="ascii">hie-lsp</span></a>という小さな<span class="ascii">Language Server Protocol</span>の実装に加え、<a href="https://github.com/mpickering/hie-lsif"><span class="ascii">hie-lsif</span></a>という、<span class="ascii">HIE</span>ファイルから「<a href="https://github.com/microsoft/language-server-protocol/blob/master/indexFormat/specification.md"><span class="ascii">Language Server Index Format (LSIF)</span></a>」形式のファイルを作成するコマンドが印象的でした。<br />
この<span class="ascii">LSIF</span>というファイルは、例えば<span class="ascii">GitHub</span>のリポジトリ上でブラウザからソースコードを閲覧する際にも、定義ジャンプといった便利な機能を使えるようにするためのものです。リポジトリに置いたソースコードを処理系がどのように解釈したかを保存しておくことで、<span class="ascii">Language Server</span>はじめ処理系を実行することなく利用できるようにするものだそうです。<br />
現状は仕様策定中なためか、実際に<span class="ascii">LSIF</span>を解釈するアプリケーションは見つかりませんでしたが、今後の活用に期待が高まりますね。</p>
<p>加えて、<span class="ascii">HIE</span>ファイルが将来的にサポートしたい機能などについても発表されました。</p>
<ul>
<li>型クラスのインスタンスが、具体的にどの型のインスタンスとして解決されたかの出力
<ul>
<li>定義ジャンプしたときに、型クラス自身の宣言ではなく、実装に飛べるようにするため</li>
</ul></li>
<li>従来<span class="ascii">GHC</span>が分割コンパイルをサポートするために、モジュールの依存情報を出力していた「インターフェースファイル<small>（<code>.hi</code>という拡張子で出力されているあのファイル）</small>」との統合</li>
<li>すべての型推論の結果</li>
</ul>
<h1 id="ghc-status-report"><span class="link-to-here-outer"><a href="#ghc-status-report" title="ghc-status-report"><span class="link-to-here">Link to<br />
here</span></a></span><span class="ascii">GHC status report</span></h1>
<p>発表者<span class="ascii">: Simon Peyton Jones</span> <em><span class="ascii">Microsoft, UK</span></em></p>
<p><span class="ascii">GitLab</span>への移行や<span class="ascii">Hadrian</span>と呼ばれる新しいビルドシステムの導入など、インフラ周りでいろいろ変更があったこともあり、遅れてしまいましたが<span class="ascii">GHC 8.8</span>がもうすぐ出るよ、という内容の発表でした<small>（発表当時。もう<a href="https://www.haskell.org/ghc/blog/20190825-ghc-8.8.1-released.html"><span class="ascii">GHC 8.8</span>はリリースされています</a>）</small>。</p>
<p>言及された主な追加機能は以下のとおりです。</p>
<ul>
<li><a href="https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#extension-TypeApplications"><code>TypeApplications</code></a>という言語拡張が、型変数だけでなくカインド変数に対しても適用できるようになりました。<br />
正直に言って、個人的に使いどころがまだまだなさそうな機能ではありますが…。</li>
<li><p><a href="https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#extension-ScopedTypeVariables"><code>ScopedTypeVariables</code></a>という言語拡張を使った場合に、パターンマッチした変数に型注釈を付けることができるようになる、という機能がありまして、これが拡張されました。<br />
具体的には、従来下記のように書くことで、関数自体の型注釈にある型変数<code>a</code>と、パターンマッチした変数<code>x</code>に型注釈した<code>b</code>が等しくなるように書くことができたのを、</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" title="1"><span class="ot">f ::</span> <span class="kw">forall</span> a<span class="op">.</span> <span class="dt">Maybe</span> a <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb1-2" title="2">f (<span class="dt">Just</span> (<span class="ot">x ::</span> b)) <span class="ot">=</span> <span class="co">{- ... -}</span></a></code></pre></div>
<p>さらに拡張して、関数自体の型注釈にある型変数<strong>ではない</strong><code>Int</code>と、パターンマッチした変数<code>x</code>に型注釈した<code>b</code>が等しくなるように書くことができるようにした、という拡張です。<br />
あたかも型変数でパターンマッチしているかのようですね。</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb2-1" title="1"><span class="ot">f ::</span> <span class="dt">Maybe</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb2-2" title="2">f (<span class="dt">Just</span> (<span class="ot">x ::</span> b)) <span class="ot">=</span> <span class="co">{- ... -}</span></a></code></pre></div>
<p>一体何の役に立つの？とも思いましたが、<a href="https://github.com/ghc-proposals/ghc-proposals/blob/master/proposals/0128-scoped-type-variables-types.rst#128motivation">この修正に向けた提案</a>曰く、</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" title="1"><span class="ot">f ::</span> <span class="dt">ReallyReallyReallyReallyLongTypeName</span> <span class="ot">-&gt;</span> <span class="dt">T</span></a>
<a class="sourceLine" id="cb3-2" title="2">f (<span class="ot">x ::</span> a) <span class="ot">=</span> … (<span class="fu">read</span> <span class="st">&quot;&quot;</span><span class="ot"> ::</span> a) …</a></code></pre></div>
<p>と書くことで、長い型名に対して別名を付けることができるようになる、というメリットがあるそうです。なるほど💡</p></li>
</ul>
<h1 id="とりあえず今回はここまで"><span class="link-to-here-outer"><a href="#とりあえず今回はここまで" title="とりあえず今回はここまで"><span class="link-to-here">Link to<br />
here</span></a></span>とりあえず今回はここまで</h1>
<p>テーマを絞って短い記事にした方が<span class="ascii">SEO</span>的にいいんじゃないかと思いまして、今回は敢えて紹介する発表を絞りました。<br />
今後は下記のテーマについて紹介する予定です。</p>
<ul>
<li><span class="ascii">HIW 2019</span>で発表された、これからの<span class="ascii">GHC</span>に入るであろう機能</li>
<li><span class="ascii">HIW 2019</span>で発表された、<span class="ascii">GHC</span>以外の言語処理系</li>
</ul>
<p>また、<span class="ascii">HIW</span>と同じく<span class="ascii">ICFP 2019</span>に併設して開催された、<a href="https://icfp19.sigplan.org/home/haskellsymp-2019"><span class="ascii">Haskell Symposium 2019</span></a>の発表についても別途共有する予定です。<br />
乞うご期待。<br />
<span class="ascii">hask(_ _)eller</span></p>
            </div>
        </div>
        <div id="post-navigation" class="row" style="margin-top: 20px;">
            <div class="col-lg-offset-2 col-lg-3 col-md-offset-1 col-md-4 col-xs-4">
                
                <i class="glyphicon glyphicon-chevron-left" aria-hidden="true" style="margin-right: 5px;"></i>
                <a href="../../posts/2019/hiw-ghc-future.html" lang="ja">HIW 2019で発表された、GHC 8.10に導入されるであろう機能</a>
                
            </div>
            <div class="col-lg-2 col-md-2 col-xs-4 text-center">
                <a href="../../" lang="ja">トップに戻る</a>
            </div>
            <div class="col-lg-3 col-md-4 col-xs-4">
                
                <a href="../../posts/2019/fallible.html" style="margin-left: auto;" lang="ja">fallibleというパッケージをリリースしました</a>
                <i class="glyphicon glyphicon-chevron-right" aria-hidden="true" style="margin-left: 5px;"></i>
                
            </div>
        </div>
    </div>
</article>



    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                        <li>
                            <a href="https://github.com/haskell-jp/blog">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    </ul>
                    <div class="text-muted notice text-center"> <br /><span class="author">&copy; Yuji Yamamoto 2019</span> <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.ja"><img alt="クリエイティブ・コモンズ・ライセンス" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a></div>
                    <div class="text-muted notice text-center">この作品は<a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.ja">クリエイティブ・コモンズ 表示 4.0 国際 ライセンス</a>の下に提供されています。</div>
                    <p class="text-muted notice">
                      当ウェブサイトでは<a href="https://support.google.com/analytics/answer/6004245?hl=ja">Google Analytics</a>でアクセス情報を収集しています。集めた情報は統計的に処理した上で、当ウェブサイトの改善のための参考情報としてのみ使用します。
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="../../js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="../../js/bootstrap.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="../../js/clean-blog.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-94110610-1', 'auto');
      ga('send', 'pageview');
    </script>
</body>

</html>
