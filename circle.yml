general:
  artifacts:
    - "generated-site/"
_cache: &_cache
  cache_directories:
    - "~/.stack/"
    - ".stack-work/"

dependencies:
  override:
    - stack setup
    - stack install --only-dependencies
  <<: *_cache

compile:
  override:
    - stack build --pedantic
    - stack exec -- site build
  <<: *_cache

test:
  override:
    - stack test --pedantic
  <<: *_cache

deployment:
  production:
    branch: master
    commands:
      # -e オプションをつけることで、GITHUB_TOKEN環境変数をmakeに渡す
      make -e deploy
